(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[863],{7270:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/upload",function(){return t(5521)}])},5521:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return ee}});var r=t(5893),i=t(2001),a=t(4051),l=t.n(a),o=t(7294),c=t(2125),s=t(1020);function u(e,n){return n||(n=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(n)}}))}function f(){var e=u(["\n    .label {\n        font-weight: bold;\n        color: ",";\n    }\n"]);return f=function(){return e},e}function p(){var e=u(["\n    ","\n"]);return p=function(){return e},e}function d(e,n){return n||(n=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(n)}}))}function h(){var e=d(["\n    width: 100%;\n    height: 20rem;\n    max-width: 100%;\n    text-align: center;\n    position: relative;\n    color: ",";\n\n    #form-file-upload {\n        width: 100%;\n        height: 100%;\n\n        border-width: 2px;\n        border-radius: 1rem;\n        border-style: dashed;\n        border-color: ",";\n        background-color: #f8fafc;\n\n        display: flex;\n        align-items: center;\n        justify-content: center;\n    }\n\n    #input-file-upload {\n        display: none;\n    }\n\n    #label-file-upload {\n        cursor: pointer;\n        width: 100%;\n    }\n\n    #label-file-upload:hover {\n        text-decoration: underline;\n    }\n\n    #label-file-upload.drag-active {\n        background-color: #ffffff;\n    }\n\n    #drag-file-element {\n        position: absolute;\n        width: 100%;\n        height: 100%;\n        border-radius: 1rem;\n        top: 0px;\n        right: 0px;\n        bottom: 0px;\n        left: 0px;\n    }\n"]);return h=function(){return e},e}function b(){var e=d(["\n    ","\n"]);return b=function(){return e},e}function m(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function g(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var r,i,a=[],l=!0,o=!1;try{for(t=t.call(e);!(l=(r=t.next()).done)&&(a.push(r.value),!n||a.length!==n);l=!0);}catch(c){o=!0,i=c}finally{try{l||null==t.return||t.return()}finally{if(o)throw i}}return a}}(e,n)||function(e,n){if(!e)return;if("string"===typeof e)return m(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(t);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return m(e,n)}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function j(){var e,n,t=(e=["\n    ","\n"],n||(n=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(n)}})));return j=function(){return t},t}var x=(0,c.ZP)("div").withConfig({componentId:"sc-c80e34ea-0"})(j(),(function(e){return(0,c.iv)(b(),(0,c.iv)(h(),s.O.itemText,s.O.itemText))})),v=function(e){var n=e.onFiles,t=e.children,i=g(o.useState(!1),2),a=i[0],l=i[1],c=o.useRef(null),s=function(e){e.preventDefault(),e.stopPropagation(),"dragenter"===e.type||"dragover"===e.type?l(!0):"dragleave"===e.type&&l(!1)};return(0,r.jsx)(x,{children:(0,r.jsxs)("form",{id:"form-file-upload",onDragEnter:s,onSubmit:function(e){return e.preventDefault()},children:[(0,r.jsx)("input",{ref:c,type:"file",id:"input-file-upload",multiple:!0,onChange:function(e){e.preventDefault(),e.target&&e.target.files&&e.target.files.length>0&&n(e.target.files)}}),(0,r.jsx)("label",{id:"label-file-upload",htmlFor:"input-file-upload",className:a?"drag-active":"",children:t}),a&&(0,r.jsx)("div",{id:"drag-file-element",onDragEnter:s,onDragLeave:s,onDragOver:s,onDrop:function(e){e.preventDefault(),e.stopPropagation(),l(!1),e.dataTransfer&&e.dataTransfer.files.length>0&&n(e.dataTransfer.files)}})]})})},y=t(7109),O=t(9396),w=t(6928);function S(e,n){return n||(n=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(n)}}))}function D(){var e=S(["\n    display: flex;\n    flex-wrap: wrap;\n    justify-content: space-around;\n"]);return D=function(){return e},e}function I(){var e=S(["\n    ","\n"]);return I=function(){return e},e}function k(e,n){return n||(n=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(n)}}))}function P(){var e=k(["\n    display: flex;\n    justify-content: space-between;\n    color: ",";\n    background: ",";\n    border: transparent 1px solid;\n    border-color: ",";\n    padding: 1rem;\n    border-radius: 1rem;\n    min-width: 20rem;\n    margin: 0.5rem;\n\n    > .sampleKbs {\n        font-weight: bold;\n        margin-left: 1rem;\n    }\n\n    input[type='checkbox'] {\n        accent-color: ",";\n    }\n"]);return P=function(){return e},e}function C(){var e=k(["\n    ","\n"]);return C=function(){return e},e}function N(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function A(e,n){if(null==e)return{};var t,r,i=function(e,n){if(null==e)return{};var t,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}function T(){var e,n,t=(e=["\n    ","\n"],n||(n=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(n)}})));return T=function(){return t},t}var z=(0,c.ZP)("div").withConfig({componentId:"sc-62b8373-0"})(T(),(function(e){return(0,c.iv)(C(),function(e){var n=e.isOnChain,t=e.withinSize;return(0,c.iv)(P(),n?s.O.itemText:t?s.O.bodyText:s.O.itemText,t?s.O.itemBG:s.O.bodyText,t?"transparent":s.O.bodyText,s.O.itemText)}(e))})),M=function(e){var n=e.sampleID,t=e.smpKbs,i=e.isOnChain,a=e.withinSize,l=e.isSelected,o=e.onChange,c=A(e,["sampleID","smpKbs","isOnChain","withinSize","isSelected","onChange"]);return(0,r.jsxs)(z,function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),r.forEach((function(n){N(e,n,t[n])}))}return e}({isOnChain:i,withinSize:a},c,{children:[(0,r.jsxs)("div",{className:"sampleID",children:["ID: ",n]}),(0,r.jsxs)("div",{className:"sampleKbs",children:[t,"kb"]}),!i&&(0,r.jsx)("input",{type:"checkbox",checked:l,onChange:function(e){o&&o(n,e.target.checked)}})]}))},E=15e6;function _(e){return 64e4*e}function X(e){return Math.round(e.length/1024*100)/100}function F(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function U(e,n){if(null==e)return{};var t,r,i=function(e,n){if(null==e)return{};var t,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}function K(){var e,n,t=(e=["\n    ","\n"],n||(n=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(n)}})));return K=function(){return t},t}var G=(0,c.ZP)("div").withConfig({componentId:"sc-f8b0c16e-0"})(K(),(function(e){return(0,c.iv)(I(),(0,c.iv)(D()))})),Z=function(e){var n=e.sampleIDs,t=e.onChainSampleIDs,i=e.selectedSampleIDs,a=e.samplesDict,l=e.maxGas,o=e.onItemSelectChange,c=U(e,["sampleIDs","onChainSampleIDs","selectedSampleIDs","samplesDict","maxGas","onItemSelectChange"]);return(0,r.jsx)(G,function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),r.forEach((function(n){F(e,n,t[n])}))}return e}({},c,{children:n.map((function(e,n){var c=t.includes(e),s=i.includes(e),u=X(a[e]),f=_(u)<l;return(0,r.jsx)(M,{sampleID:e,isOnChain:c,isSelected:s,smpKbs:u,withinSize:f,onChange:o},n)}))}))};function B(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function L(e,n,t,r,i,a,l){try{var o=e[a](l),c=o.value}catch(s){return void t(s)}o.done?n(c):Promise.resolve(c).then(r,i)}function $(e){return function(){var n=this,t=arguments;return new Promise((function(r,i){var a=e.apply(n,t);function l(e){L(a,r,i,l,o,"next",e)}function o(e){L(a,r,i,l,o,"throw",e)}l(void 0)}))}}function R(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function V(e,n){if(null==e)return{};var t,r,i=function(e,n){if(null==e)return{};var t,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}function q(e){return function(e){if(Array.isArray(e))return B(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,n){if(!e)return;if("string"===typeof e)return B(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(t);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return B(e,n)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function H(){var e,n,t=(e=["\n    ","\n"],n||(n=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(n)}})));return H=function(){return t},t}var J=(0,c.ZP)("div").withConfig({componentId:"sc-61338f81-0"})(H(),(function(e){return(0,c.iv)(p(),(0,c.iv)(f(),s.O.itemText))})),Q=function(e){var n,t,i,a=function(){if(0!=P.length){var e=P.filter((function(e){return!A.includes(e)}));I(e)}},c=function(){I([])},s=function(e){var n=(0,y.iD)(e,!0),t=n.moduleName,i=n.numChan,a=n.numPat,l=n.numInst;return(0,r.jsxs)(o.Fragment,{children:[(0,r.jsx)("h2",{children:"Tune Info"}),(0,r.jsxs)("p",{children:[(0,r.jsx)("span",{className:"label",children:"Name:"})," ",t]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("span",{className:"label",children:"Number of Channels:"})," ",i]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("span",{className:"label",children:"Number of Patterns:"})," ",a]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("span",{className:"label",children:"Number of Instruments:"})," ",l]})]})},u=(e.children,V(e,["children"])),f=(0,O.useMetaMask)(),p=f.connect,d=f.account,h=f.chainId,b=f.status,m=(0,w._f)(),g=m.earThereumContract,j=m.getExistingSampleIDs,x=m.convertIDsToBytes4,S=(0,o.useState)([]),D=S[0],I=S[1],k=(0,o.useState)([]),P=k[0],C=k[1],N=(0,o.useState)([]),A=N[0],T=N[1],z=(0,o.useState)(null),M=z[0],F=z[1],U=(0,o.useState)(null),K=U[0],G=U[1],B=(0,o.useState)(),L=B[0],H=B[1],Q=(n=K)?n.length/1024:0,W=_(Q),Y=(i=D,(t=M)?i.reduce((function(e,n){return t[n].length+e}),0)/1024:0),ee=_(Y),ne=Math.ceil(W/E),te=Math.ceil(ee/E),re=ne+te,ie=function(e){e.length>0&&e[0].arrayBuffer().then((function(e){var n=ae(e),t=n.sampleIDs,r=n.compressedSmpsDict,i=n.compressedXM,a=t.filter((function(e,n,t){return t.indexOf(e)===n}));C(a),I([]),F(r),G(i),H(new Uint8Array(e))}))},ae=function(e){var n=(0,y.wu)(new Uint8Array(e)),t=n.strippedXM,r=n.samples,i=(0,y.mD)(r),a=i.compressedSmpsDict,l=i.sampleIDs;return(0,y._9)(t,l),{strippedXM:t,compressedXM:(0,y.wp)(t),compressedSmpsDict:a,sampleIDs:l}},le=function(e,n){if(n)D.includes(e)||I(q(D).concat([e]));else{var t=D.filter((function(n){return n!=e}));I(t)}};function oe(){return ce.apply(this,arguments)}function ce(){return(ce=$(l().mark((function e(){var n,t,r,i,a,o,c,s,u,f;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(g&&M&&D.length>0)){e.next=32;break}n=D.map((function(e){if(!M[e])throw"Sample '".concat(e,"' doesn't exist in compressedSmpsDic");return M[e]})),t=[],r=0,i=1;case 5:if(!(r<D.length)){e.next=29;break}a=0;case 7:if(!(i-1<n.length)){e.next=17;break}if(o=X(n[i-1]),c=_(o),!((a+c)/E<1)){e.next=14;break}a+=c,i+=1,e.next=15;break;case 14:return e.abrupt("break",17);case 15:e.next=7;break;case 17:return s=x(D.slice(r,i)),u=n.slice(r,i),console.log("batchSampleIDs.length: ".concat(s.length," batchSampleData.length: ").concat(u.length)),console.log("Attempting to upload the following: ",s,u),e.next=23,g.uploadSamples(s,u);case 23:f=e.sent,t.push(f.wait()),r=i,i+=1,e.next=5;break;case 29:return e.next=31,Promise.all(t);case 31:console.log("ALL DONE!");case 32:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function se(){return ue.apply(this,arguments)}function ue(){return(ue=$(l().mark((function e(){var n,t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(K&&g){e.next=2;break}return e.abrupt("return");case 2:return n=(0,y.Vg)(K),e.next=5,g.uploadXM("0x"+n,K);case 5:return t=e.sent,e.next=8,t.wait();case 8:console.log("XM Uploaded: ".concat(n));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return(0,o.useEffect)((function(){P&&P.length>0&&$(l().mark((function e(){var n;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j(P);case 2:n=e.sent,T(n);case 4:case"end":return e.stop()}}),e)})))()}),[j,P]),(0,r.jsxs)(J,function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),r.forEach((function(n){R(e,n,t[n])}))}return e}({},u,{children:[(0,r.jsx)("h1",{children:"Upload"}),"connected"!=b&&(0,r.jsx)("button",{onClick:function(){p()},children:"Connect"}),d&&(0,r.jsxs)("p",{children:["Account: ",d]}),h&&(0,r.jsxs)("p",{children:["Chain: ",parseInt(h,16)]}),"connected"==b&&(0,r.jsxs)(o.Fragment,{children:[(0,r.jsxs)(v,{onFiles:ie,children:[(0,r.jsxs)("p",{children:["Drag and drop your ",(0,r.jsx)("b",{children:"XM"})," file here or click to browse"]}),(0,r.jsxs)("p",{children:["Files are currently limited to FastTracker ",(0,r.jsx)("b",{children:"XM"})," modules using ",(0,r.jsx)("b",{children:"8-bit"})," samples"]})]}),L&&s(L),M&&P&&(0,r.jsxs)(o.Fragment,{children:[(0,r.jsx)("h2",{children:"Samples"}),(0,r.jsx)("p",{children:"Any items with a dark background are too large to upload"}),(0,r.jsx)(Z,{sampleIDs:P,onChainSampleIDs:A,selectedSampleIDs:D,onItemSelectChange:le,samplesDict:M,maxGas:E})]}),P.length>0&&(A.length!=P.length?(0,r.jsxs)(o.Fragment,{children:[(0,r.jsx)("button",{onClick:a,children:"Select All"}),(0,r.jsx)("button",{onClick:c,children:"Deselect All"})]}):(0,r.jsx)("p",{children:"All samples uploaded"})),(K||P.length>0)&&(0,r.jsxs)(o.Fragment,{children:[(0,r.jsx)("h2",{children:"Selected Items"}),(0,r.jsxs)("p",{children:[(0,r.jsx)("span",{className:"label",children:"XM Kb:"})," ",Math.round(100*Q)/100," ",(0,r.jsx)("span",{className:"label",children:"gas:"})," ",W," ",(0,r.jsx)("span",{className:"label",children:"transactions:"})," ",ne]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("span",{className:"label",children:"Sample Kb:"})," ",Math.round(100*Y)/100," ",(0,r.jsx)("span",{className:"label",children:"gas:"})," ",ee," ",(0,r.jsx)("span",{className:"label",children:"transactions:"})," ",te]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("span",{className:"label",children:"Total Kb:"})," ",Math.round(100*(Q+Y))/100]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("span",{className:"label",children:"Total Gas:"})," ",ee+W]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("span",{className:"label",children:"Total transaction count:"})," ",re]})]}),D.length>0&&(0,r.jsx)("button",{onClick:oe,children:"Upload Samples"}),K&&ne<=1&&A.length==P.length&&(0,r.jsx)("button",{onClick:se,children:"Upload XM"})]})]}))},W=t(9008),Y=t.n(W),ee=function(){return(0,r.jsxs)("div",{children:[(0,r.jsxs)(Y(),{children:[(0,r.jsx)("title",{children:"Immutatune: Upload"}),(0,r.jsx)("meta",{property:"og:title",content:"Immutatune: Upload"},"title")]}),(0,r.jsx)(i.A,{children:(0,r.jsx)(Q,{})})]})}}},function(e){e.O(0,[655,424,565,774,888,179],(function(){return n=7270,e(e.s=n);var n}));var n=e.O();_N_E=n}]);